# Create an uiComponent with Magento 2

## Layout declaration

The layout’s name is associated with the controller.

Create the following file :

`app/code/Test/Jobs/view/adminhtml/layout/jobs_department_index.xml`

```xml
<?xml version="1.0"?>
<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd">
    <body>
        <referenceContainer name="content">
            <uiComponent name="jobs_department_listing"/>
        </referenceContainer>
    </body>
</page>
```

"uiComponent": "jobs\_department\_listing" =&gt; name of component file.

## uiComponent creation

create the file :

`app/code/Test/Jobs/view/adminhtml/ui_component/jobs_department_listing.xml`

```xml
<listing xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="urn:magento:module:Magento_Ui:etc/ui_configuration.xsd">
    <!-- Integration -->
    <argument name="data" xsi:type="array">
        <item name="js_config" xsi:type="array">
            <!-- we define a provider -->
            <item name="provider" xsi:type="string">jobs_department_listing.jobs_department_listing_data_source</item>
            <!-- same string as above -->
            <item name="deps" xsi:type="string">jobs_department_listing.jobs_department_listing_data_source</item>
        </item>
    </argument>
    <!-- Data source -->
    <dataSource name="jobs_department_listing_data_source">
        <argument name="dataProvider" xsi:type="configurableObject">
            <argument name="class" xsi:type="string">DepartmentGridDataProvider</argument> <!-- Data provider class -->
            <argument name="name" xsi:type="string">jobs_department_listing_data_source
            </argument> <!-- provider defined above -->
            <argument name="primaryFieldName" xsi:type="string">entity_id</argument> <!-- Primary key -->
            <argument name="requestFieldName" xsi:type="string">id</argument> <!-- URL name parameter -->

            <argument name="data" xsi:type="array">
                <item name="config" xsi:type="array">
                    <item name="component" xsi:type="string">Magento_Ui/js/grid/provider</item>
                    <item name="update_url" xsi:type="url" path="mui/index/render"/>
                    <item name="storageConfig" xsi:type="array">
                        <!-- Primary key column name -->
                        <item name="indexField" xsi:type="string">entity_id</item>
                    </item>
                </item>
            </argument>
        </argument>
    </dataSource>
</listing>
```

On the first part "Integration", we define a provider. This provider has the type "jobs\_department\_listing\_data\_source".

On the part "Data source".

* class: the object which allow us to give the content we will put on the grid

* name: the dataProvider’s name. We put the same as the dataSource.

* primaryFieldName: primary key name

* requestFieldName: name of the parameter sent on the url for the primaryFieldName

Use the dependency injection to create an object "DepartmentGridDataProvider".

## Dependency injection \(di.xml\)

Create the file :

`app/code/Test/Jobs/etc/di.xml`

```xml
<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <!-- Create our type DepartmentGridDataProvider -->
    <virtualType name="DepartmentGridDataProvider"
                 type="Magento\Framework\View\Element\UiComponent\DataProvider\DataProvider">
        <arguments>
            <argument name="collection" xsi:type="object" shared="false">Test\Jobs\Model\Resource\Department\Collection</argument>
            <argument name="filterPool" xsi:type="object" shared="false">DepartmentGridFilterPool</argument> <!-- Define new object for filters -->
        </arguments>
    </virtualType>

    <!-- Create our type DepartmentGridFilterPool -->
    <virtualType name="DepartmentGridFilterPool"
                 type="Magento\Framework\View\Element\UiComponent\DataProvider\FilterPool">
        <arguments>
            <argument name="appliers" xsi:type="array">
                <item name="regular" xsi:type="object">Magento\Framework\View\Element\UiComponent\DataProvider\RegularFilter</item>
                <item name="fulltext" xsi:type="object">Magento\Framework\View\Element\UiComponent\DataProvider\FulltextFilter</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Type for jobs_department_listing_data_source -->
    <type name="Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory">
        <arguments>
            <argument name="collections" xsi:type="array">
                <item name="jobs_department_listing_data_source" xsi:type="string">Test\Jobs\Model\ResourceModel\Grid\Department\Collection</item>
            </argument>
        </arguments>
    </type>

    <!-- Simulate our class Test\Jobs\Model\ResourceModel\Grid\Department\Collection -->
    <virtualType name="Test\Jobs\Model\ResourceModel\Grid\Department\Collection"
                 type="Magento\Framework\View\Element\UiComponent\DataProvider\SearchResult">
        <arguments>
            <argument name="mainTable" xsi:type="string">maxime_department</argument>
            <argument name="resourceModel" xsi:type="string">Test\Jobs\Model\ResourceModel\Department</argument>
        </arguments>
    </virtualType>
</config>
```

Create DepartmentGridDataProvider object, defined by two elements :

* collection : it’s a department collection, so we put our class Test\Jobs\Model\Resource\Department\Collection.

* filterPool : We give a new object we will define after.

* mainTable : the table containing our elements

* resourceModel : the resource model class of our element

* dataProvider jobs\_department\_listing\_data\_source, it's dataSource name in ui\_component

# Create adminhtml grid with Magento 2

## Add an "Add new" button

Edit file:

`app/code/Test/Jobs/view/adminhtml/ui_component/jobs_department_listing.xml`

Add code after the "js\_config" node :

```xml
<!-- define column type -->
<item name="spinner" xsi:type="string">jobs_department_columns</item>
<!-- Button to add new item -->
<item name="buttons" xsi:type="array">
    <item name="add" xsi:type="array">
        <item name="name" xsi:type="string">add</item>
        <item name="label" xsi:type="string" translate="true">Add New Department</item>
        <item name="class" xsi:type="string">primary</item>
        <item name="url" xsi:type="string">*/*/new
        </item> <!-- magento will translate it by jobs/department/new -->
    </item>
</item>
```

Create our button:

* name: the name of the button

* label: the text inside the button

* class: a html class for the button \(will be displayed in orange with "primary" class\)

* url: button URL. Magento changes \* with current url part, so "\*/\*/new" will become "jobs/department/new"

## Container creation : listing\_top

After the dataSource node, we will add action buttons. This part will be called "listing\_top"

```xml
<!-- Container Listing Top -->
<container name="listing_top">
    <argument name="data" xsi:type="array">
        <item name="config" xsi:type="array">
            <item name="template" xsi:type="string">ui/grid/toolbar</item>
        </item>
    </argument>
    <!-- Button to manage views -->
    <bookmark name="bookmarks">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="component" xsi:type="string">Magento_Ui/js/grid/controls/bookmarks/bookmarks</item>
                <item name="displayArea" xsi:type="string">dataGridActions</item>
                <item name="storageConfig" xsi:type="array">
                    <item name="saveUrl" xsi:type="url" path="mui/bookmark/save"/>
                    <item name="deleteUrl" xsi:type="url" path="mui/bookmark/delete"/>
                    <item name="namespace" xsi:type="string">jobs_department_listing</item>
                </item>
            </item>
        </argument>
    </bookmark>
    <!-- Button to manage columns -->
    <container name="columns_controls">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="columnsData" xsi:type="array">
                    <item name="provider" xsi:type="string">
                        jobs_department_listing.jobs_department_listing.jobs_department_columns
                    </item>
                </item>
                <item name="component" xsi:type="string">Magento_Ui/js/grid/controls/columns</item>
                <item name="displayArea" xsi:type="string">dataGridActions</item>
            </item>
        </argument>
    </container>
</container>
```

## Columns creation

Created a "spinner" named "jobs\_department\_columns".

Just after "Listing top zone", add this following XML:

```xml
<columns name="jobs_department_columns">
    <!-- ID Column -->
    <column name="entity_id">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="filter" xsi:type="string">textRange</item>
                <item name="sorting" xsi:type="string">asc</item>
                <item name="label" xsi:type="string" translate="true">ID</item>
            </item>
        </argument>
    </column>

    <!-- Name Column -->
    <column name="name">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="filter" xsi:type="string">text</item>
                <item name="editor" xsi:type="array">
                    <item name="editorType" xsi:type="string">text</item>
                    <item name="validation" xsi:type="array">
                        <item name="required-entry" xsi:type="boolean">true</item>
                    </item>
                </item>
                <item name="label" xsi:type="string" translate="true">Name</item>
            </item>
        </argument>
    </column>
</columns>
```

* ID: the department ID

* Name: the department name

Compile data:

```xml
sudo php bin/magento setup:di:compile
```



