# Create the frontend HTML of your Magento 2 module

## File : routes.xml

Create the file:  
`app/code/Test/Jobs/etc/frontend/routes.xml`

```xml
<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:App/etc/routes.xsd">
    <router id="standard">
        <route id="jobs" frontName="jobs">
            <module name="Test_Jobs"/>
        </route>
    </router>
</config>
```

## Frontend Controller creation

Create file:

`app/code/Test/Jobs/Controller/Job/Index.php`

```php
namespace Test\Jobs\Controller\Job;
class Index extends \Magento\Framework\App\Action\Action
{
    public function execute()
    {
        $this->_view->loadLayout();
        $this->_view->getLayout()->initMessages();
        $this->_view->renderLayout();
    }
}
```

## Layout creation

Create file:

`app/code/Test/Jobs/view/frontend/layout/jobs_job_index.xml`

```xml
<?xml version="1.0"?>
<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd"
      layout="2columns-right">
    <body>
        <referenceContainer name="content">
            <block class="Test\Jobs\Block\Job\ListJob" name="jobs_list" template="jobs/list.phtml"/>
        </referenceContainer>
    </body>
</page>
```

## Block creation

Create the file

`app/code/Test/Jobs/Block/Job/ListJob.php`

> We have to put ListJob because List is a keyword for PHP

```php
namespace Test\Jobs\Block\Job;
class ListJob extends \Magento\Framework\View\Element\Template
{

    protected $_job;

    protected $_department;

    protected $_resource;

    protected $_jobCollection = null;

    /**
     * @param \Magento\Framework\View\Element\Template\Context $context
     * @param \Test\Jobs\Model\Job $job
     * @param \Test\Jobs\Model\Department $department
     * @param \Magento\Framework\App\ResourceConnection $resource
     * @param array $data
     */
    public function __construct(
        \Magento\Framework\View\Element\Template\Context $context,
        \Test\Jobs\Model\Job $job,
        \Test\Jobs\Model\Department $department,
        \Magento\Framework\App\ResourceConnection $resource,
        array $data = []
    )
    {
        $this->_job = $job;
        $this->_department = $department;
        $this->_resource = $resource;

        parent::__construct(
            $context,
            $data
        );
    }

    /**
     * @return $this
     */
    protected function _prepareLayout()
    {
        parent::_prepareLayout();


        // You can put these informations editable on BO
        $title = __('We are hiring');
        $description = __('Look at the jobs we have got for you');
        $keywords = __('job,hiring');

        $this->getLayout()->createBlock('Magento\Catalog\Block\Breadcrumbs');

        if ($breadcrumbsBlock = $this->getLayout()->getBlock('breadcrumbs')) {
            $breadcrumbsBlock->addCrumb(
                'jobs',
                [
                    'label' => $title,
                    'title' => $title,
                    'link' => false // No link for the last element
                ]
            );
        }

        $this->pageConfig->getTitle()->set($title);
        $this->pageConfig->setDescription($description);
        $this->pageConfig->setKeywords($keywords);


        $pageMainTitle = $this->getLayout()->getBlock('page.main.title');
        if ($pageMainTitle) {
            $pageMainTitle->setPageTitle($title);
        }

        return $this;
    }

    protected function _getJobCollection()
    {
        if ($this->_jobCollection === null) {

            $jobCollection = $this->_job->getCollection()
                ->addFieldToSelect('*')
                ->addFieldToFilter('status', $this->_job->getEnableStatus())
                ->join(
                    array('department' => $this->_department->getResource()->getMainTable()),
                    'main_table.department_id = department.' . $this->_job->getIdFieldName(),
                    array('department_name' => 'name')
                );

            $this->_jobCollection = $jobCollection;
        }
        return $this->_jobCollection;
    }


    public function getLoadedJobCollection()
    {
        return $this->_getJobCollection();
    }

    public function getJobUrl($job)
    {
        if (!$job->getId()) {
            return '#';
        }

        return $this->getUrl('jobs/job/view', ['id' => $job->getId()]);
    }

    public function getDepartmentUrl($job)
    {
        if (!$job->getDepartmentId()) {
            return '#';
        }

        return $this->getUrl('jobs/department/view', ['id' => $job->getDepartmentId()]);
    }
}
```

* prepareLayout =&gt; create the breadcrumbs and set metas datas of the page.

* \_getJobCollection =&gt; retrieve the collection to get.

* getLoadedJobCollection is public, this is the one will be called on the template file.

* getJobUrl =&gt; allow us to retrieve the job’s URL.

* getDepartmentUrl =&gt; same for departments.

## List template creation

Create the file :

`app/code/Test/Jobs/view/frontend/templates/jobs/list.phtml`

```php
<?php
$jobCollection = $this->getLoadedJobCollection();
$iterator = 1;
$total = $jobCollection->count();
?>

<div class="job-wrapper">
    <ol class="jobs list">
        <?php foreach ($jobCollection AS $job): ?>
            <li class="item<?php echo ($iterator == 1) ? ' first' : ''; ?><?php echo ($total == $iterator) ? ' last' : ''; ?>">
                <div class="title">
                    <a href="<?php echo $this->getJobUrl($job); ?>" title="<?php echo $job->getTitle(); ?>">
                        <?php echo $job->getTitle(); ?>
                    </a>
                </div>
                <div class="department_name">
                    <?php echo __('Department : '); ?>
                    <a href="<?php echo $this->getDepartmentUrl($job); ?>"
                       title="<?php echo $job->getDepartmentName(); ?>">
                        <?php echo $job->getDepartmentName(); ?>
                    </a>
                </div>
                <div class="type"><?php echo $job->getType(); ?></div>
                <div class="location"><?php echo $job->getLocation(); ?></div>
                <div class="date"><?php echo $this->formatDate($job->getDate()); ?></div>
                <div class="description"><?php echo $job->getDescription(); ?></div>
            </li>
            <?php $iterator++; ?>
        <?php endforeach; ?>
    </ol>
</div>
```

# Manipulate collections with Magento 2

Edit file:

`app/code/Test/Jobs/Block/Job/ListJob.php`

```php
protected function _getJobCollection()
    {
        if ($this->_jobCollection === null) {
            $jobCollection = $this->_job->getCollection()->addStatusFilter($this->_job, $this->_department);
            $this->_jobCollection = $jobCollection;
        }
        return $this->_jobCollection;
    }
```

Edit file:

`app/code/Test/Jobs/Model/ResourceModel/Job/Collection.php`

```php
public function addStatusFilter($job, $department)
{
    $this->addFieldToSelect('*')
        ->addFieldToFilter('status', $job->getEnableStatus())
        ->join(
            array('department' => $department->getResource()->getMainTable()),
            'main_table.department_id = department.' . $department->getIdFieldName(),
            array('department_name' => 'name')
        );

    return $this;
}
```

## Show the SQL of the collection

```xml
var_dump($this->getSelect().'')
or
var_dump($this->getSelect()->__toString();)
```

## Apply filters on collection

```php
$this->addFieldToSelect('*')
     ->addFieldToFilter('status', $job->getEnableStatus());
```

or

```php
$this->addFieldToSelect('*')
      ->addFieldToFilter('status', array('eq' => $job->getEnableStatus()));
```

| Operator | Action |
| :--- | :--- |
| eq | Is equal |
| gteq | Greater than equal |
| gt | Greater than |
| lteq | Less than equal |
| lt | Less than |
| neq | Not equal |
| like | SQL like \(don’t forget to add ‘%’\) |
| nlike | SQL Not Like \(don’t forget to add ‘%’\) |
| in | Among |
| nin | Not among |
| null | Is null \(the array value does not matter, only the key is important\) |
| notnull | Is not null \(the array value does not matter, only the key is important\) |
| finset | MySQL FIND\_IN\_SET, for columns with value like “valeur1,valeur2,valeurX”. Ex : Where value “100” exists on this string “76,82,100,628” |

## AND contidion with collections

```php
$this->addFieldToSelect('*')
            ->addFieldToFilter('status', array('eq' => $job->getEnableStatus()))
            ->addFieldToFilter('date', array('gt' => date('Y-m-d')));
```

## OR condition with collections

```php
$this->addFieldToSelect('*')
            ->addFieldToFilter(
                array(
                    'status',
                    'date'
                ),
                array(
                    array('eq' => $job->getEnableStatus()),
                    array('gt' => date('Y-m-d'))
                )
            );
```

## Joins with collections

```php
$this->addFieldToSelect('*')
            ->addFieldToFilter('status', $job->getEnableStatus())
            ->join(
                array('department' => $department->getResource()->getMainTable()),
                'main_table.department_id = department.'.$department->getIdFieldName(),
                array('department_name' => 'name')
            );
```

3 parameters :

* The first is the table name we want to join, we retrieve the name with the Magento method getTableName. The array key is the alias table \(AS in SQL\)

* The second is the join condition, here we put the department ID condition.

* The third is an array of the columns we want to put on our SELECT. If nothing is put, we will have a SELECT \* on the department table. The array key is the column alias, the value is the column on the database table. If no key is setted, columns will not be renamed \(no "AS" in SQL\).

> The benefit to use the getSelect\(\) on our collection class is we can always return "$this" to return a collection object. If you did the getSelect\(\) on the block, you would not have a collection object, but a Zend\_Select object which is more complicated to use than collection on the block.

```php
$this->addFieldToSelect('*')
            ->addFieldToFilter('status', $job->getEnableStatus())
            ->addFieldToFilter(
                array(
                    'name',
                    'date'
                ),
                array(
                    array('like' => '%Sample%'),
                    array('gteq' => date('Y-m-d'))
                )
            )
            ->getSelect()
            ->joinLeft(
                array('department' => $department->getResource()->getMainTable()),
                'main_table.department_id = department.'.$department->getIdFieldName(),
                array('department_name' => 'name')
            );
```

```php
$this->addFieldToSelect('*')
            ->getSelect()
            ->joinLeft(
                array('department' => $department->getResource()->getMainTable()),
                'main_table.department_id = department.'.$department->getIdFieldName(),
                array('department_name' => 'name')
            )
            ->where('main_table.status = ?', $job->getEnableStatus())
            ->orWhere('main_table.status = ? AND main_table.date >= '.date('Y-m-d'), $job->getDisableStatus())
            ->orWhere('main_table.'.$job->getIdFieldName().' > 0 && (main_table.date < '.date('Y-m-d').' || department.name LIKE "%mar%")');
```

# Add CSS on your Magento 2 module

## Layout creation and CSS adding

Modify the following layout file :

`app/code/Test/Jobs/view/frontend/layout/jobs_job_index.xml`

```xml
<?xml version="1.0"?>
<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd"
      layout="2columns-right">
    <head>
        <css src="Test_Jobs::jobs.css"/>
    </head>
    <body>
        <referenceContainer name="content">
            <block class="Test\Jobs\Block\Job\ListJob" name="jobs_list" template="jobs/list.phtml"/>
        </referenceContainer>
    </body>
</page>
```

Add a stylesheet on every page, create this layout :

`app/code/Test/Jobs/view/frontend/layout/default.xml`

```xml
<?xml version="1.0"?>
<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd"
      layout="2columns-right">
    <head>
        <css src="Test_Jobs::jobs.css"/>
    </head>
</page>
```

Create css file \(with the .less extension\):

`app/code/Test/Jobs/view/frontend/web/jobs.less`

```less
ol.jobs {
  list-style-type: none;
  padding: 0;
  margin: 0;

  .item {
    border-bottom: 1px solid black;
    margin-bottom: 2rem;
    padding-bottom: 2rem;

    .title {
      font-size: 1.3em;
      margin-bottom: 1rem;
    }
  }

  .item.last {
    border-bottom: none;
  }
}
```

Magento "precompile" CSS file and save it in two folders :  
`var/viewpreprocessed    
pub/static/frontend/Magento/luma/en_US/Maxime_Jobs`

You can delete these two folders, and your changes will be displayed.

Command line to deploy this type of contents :

`php bin/magento setup:static-content:deploy`

